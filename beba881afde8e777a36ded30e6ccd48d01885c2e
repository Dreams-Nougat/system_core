Revision: beba881afde8e777a36ded30e6ccd48d01885c2e
Patch-set: 1
File: run-as/run-as.c

26:18-26:19
Thu Mar 26 00:20:41 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c352b622_23e8bda5
Bytes: 147
#include <sys/cdefs.h> // pull in __noreturn

NB: We need to make sure this is not built on HOST, Windows or MAC as this is bionic-only definition.

26:18-26:19
Thu Mar 26 00:28:04 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: c352b622_23e8bda5
UUID: 834c3e8c_7e02d190
Bytes: 43
(this wouldn't make any sense on the host.)

92
Thu Mar 26 00:07:57 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_1e019d07
Bytes: 8
fprintf?

92
Thu Mar 26 00:20:41 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 834c3e8c_1e019d07
UUID: 834c3e8c_3e3b3980
Bytes: 114
Well, should move panic above us, and use it instead.

I am not fond of the double-newline either on this message.

107:0-107:1
Thu Mar 26 00:20:41 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: c352b622_03b4a1c3
Bytes: 13
} __noreturn;

133
Thu Mar 26 00:07:57 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_fe05a113
Bytes: 27
all these returns are dead.

133
Thu Mar 26 00:20:41 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 834c3e8c_fe05a113
UUID: 834c3e8c_7ecad11f
Bytes: 48
Yup & __attribute__((__noreturn__)) on panic ...

158:0-161:5
Thu Mar 26 00:20:50 2015 +0000
Author: Nick Kralevich <1003966@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_de0305c5
Bytes: 177
Is this really needed? We don't want to hold on to capabilities which we inadvertently received. I don't see the value to querying our existing capabilities before setting them.

158:0-161:5
Thu Mar 26 00:27:33 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 834c3e8c_de0305c5
UUID: c352b622_234c3d4e
Bytes: 121
_agreed_, this is really left over from my debug code where I instrumented all phases. I count this as a 'good catch' :-)

182:0-186:5
Thu Mar 26 00:20:50 2015 +0000
Author: Nick Kralevich <1003966@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_5e46f513
Bytes: 188
This isn't necessary. Calling setresuid() always drops all capabilities unless prctl(PR_SET_KEEPCAPS) is called, which it isn't here. Please see the PR_SET_KEEPCAPS section of "man prctl".

182:0-186:5
Thu Mar 26 00:23:58 2015 +0000
Author: Nick Kralevich <1003966@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 834c3e8c_5e46f513
UUID: 834c3e8c_fe6a415d
Bytes: 159
Actually, please double check this. There's reference in the man page to PR_SET_KEEPCAPS only applying when the previous UID=0, which may not be the case here.

202
Thu Mar 26 00:07:57 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_3e15793f
Bytes: 10
s/ Error//

210
Thu Mar 26 00:07:57 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 834c3e8c_9e0c6d3c
Bytes: 9
strerror?

