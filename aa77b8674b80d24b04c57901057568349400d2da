Revision: aa77b8674b80d24b04c57901057568349400d2da
Patch-set: 3
File: liblog/Android.mk

76
Mon Feb 23 17:25:51 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 48a17a0b_f12c828d
Bytes: 107
"...and is meant for use in the recovery image."? it would be a mistake for anyone else to use this, right?

76
Mon Feb 23 18:39:16 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 48a17a0b_f12c828d
UUID: a880367a_849fa8f8
Bytes: 640
I think this is premature since the recovery image could easily deploy logd if we moved it up the chain into the ramdisk. The idea should be split into another CL?

stderr is considered a /dev/null on the Recovery image. The current logging library will send the logging information to pstore _and_ logd (if it exists), and pstore information can be retrieved on reboot; a better solution than stderr. What about sending to /dev/kmsg? All these questions add doubt to the value of liblog-stderr for the Recovery image.

The static library is less useful, an accompanying shared library should be built for the recovery image to use perhaps?

76
Tue Feb 24 13:45:57 2015 +0000
Author: Narayan Kamath <1014443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a880367a_849fa8f8
UUID: a5022140_519d147b
Bytes: 313
The recovery code (installer, updater) reopen /cache/recovery/last_log as both stdout / stderr so i guess it's their rudimentary mechanism of storing information that can be retrieved on reboot.

I'm not sure why they chose that over /sys/fs/pstore but it's a system that is simplistic and has worked well so far.

76
Tue Feb 24 15:43:11 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a5022140_519d147b
UUID: 650ca978_af5979f8
Bytes: 381
Well, pstore is only available on 3.10+ kernels (N6 and N9); but if available, it beats putting PII into the filesystem for security concerns (we get pushback when we even mention saving android logs into a file).

<editorial>
KISS is _always_ king; what-ifs are only necessary to ensure a design is future-proofed; nothing here precludes small CL followups to refine.
</editorial>

File: liblog/stderr_log.c

17
Mon Feb 23 17:25:51 2015 +0000
Author: Elliott Hughes <1003224@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 48a17a0b_31472a45
Bytes: 39
this whole comment can just be removed.

232:3-232:60
Mon Feb 23 18:39:16 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: 08722291_7425e8a2
Bytes: 251
Why not leverage logprint.c?

I know not perfect or completely adaptable as-is, but it can form a standard for translating logging messages to logcat format.

There are repeating themes in this call that match andorid_log_printLogLine for instance ...

232:3-232:60
Mon Feb 23 20:09:45 2015 +0000
Author: Narayan Kamath <1014443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 08722291_7425e8a2
UUID: 885e12fc_98d71501
Bytes: 302
despite what gerritt is telling you, this isn't new code (it's git rename detection gone bad). 

I don't mind rewriting this code to use the function you mention, since this code smells like a copy :). I'll try and figure out how hard that is (and might move that work to a follow up if it's too hard).

232:3-232:60
Mon Feb 23 21:01:46 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 885e12fc_98d71501
UUID: c832cad2_4def8db4
Bytes: 95
Cool, the mere fact you are considering it is fine with me.

(Did I just 'volunteer' you? :-) )

346:0-346:4
Mon Feb 23 18:39:16 2015 +0000
Author: Mark Salyzyn <1032276@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: a880367a_0422b818
Bytes: 11
whtie space

346:0-346:4
Mon Feb 23 20:09:45 2015 +0000
Author: Narayan Kamath <1014443@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: a880367a_0422b818
UUID: 885e12fc_b8dcd923
Bytes: 21
(see above, will fix)

