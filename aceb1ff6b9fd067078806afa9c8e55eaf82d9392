Revision: aceb1ff6b9fd067078806afa9c8e55eaf82d9392
Patch-set: 2
File: crash_reporter/crash_sender

471
Fri Oct 23 20:29:57 2015 +0000
Author: Mike Frysinger <1040868@85c56323-6fa9-3386-8a01-6480fb634889>
UUID: d6a371b1_90b3d422
Bytes: 513
where did we require/guarantee that |id| and |product| and |exec_name| do not have ' or trailing \ in them ?  we should add a json check func to sanitize & log an error when they're bad.

i don't mean try and blacklist certain behavior like looking for a ' in the middle or a \ at the end -- you get into pathological cases like foo\'bar (which is valid) and bar\\\\ (which is valid).  let's whitelist values with a regex like [[:alnum:]_].  exec_name prob needs to allow through a bit more, but you get the idea.

471
Fri Oct 23 23:47:59 2015 +0000
Author: Steve Fung <1076778@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: d6a371b1_90b3d422
UUID: 96df3923_c4ccd2c1
Bytes: 1791
To clarify, when you say sanitize and whitelist values, are you saying that we should just "filter" out non alnum characters from the log?  So that a product name of "my_product'name\" just gets printed to the log as "myproductname" and logs an error when the filtered name isn't the same as the original?  That would be fine with me and pretty easy to do for just this log file.

But if we're talking about checking the fields across all of crash_sender, including the actual sending of the report in the curl command above, I'm a little against the idea of doing any kind of modifications (other than adding character escapes) in the crash sender code, for several reasons.
1) Except for ID, which is assigned by the crash server and I thought would always be in [:alnum:], these fields are all controlled by the device manufacturer.  Device users shouldn't be able to modify any of these fields on their device.  Manufacturers *shouldn't* be doing anything ridiculous like adding quotes or a trailing slash.  A trailing slash at least right now, actually is really hard to even accomplish for the fields as I believe it would break the Android build system where the fields are set.  Once we get the product spec/config work going, its also something we should add as a config validation and throw a build time error for invalid settings.
2) Sending a value other than what was set will prevent the crash report from being directed to the correct project on the crash server.  Some products do have non-[:alnum:] characters.  Our own example applications use both ':' and '-' characters in their product names, for instance.
3) Other parts of the system (like metrics) use these fields, so we shouldn't modify them (other than character escapes) when dealing with them outside the device.

471
Sat Oct 24 15:45:54 2015 +0000
Author: Mike Frysinger <1040868@85c56323-6fa9-3386-8a01-6480fb634889>
Parent: 96df3923_c4ccd2c1
UUID: 76880537_2d9bad72
Bytes: 809
correct values of |product| are gated by the server.  while the device manuf gets to choose it, it's done so based on the server constraints.  i threw out [:alnum:] as a straw man ... i'm happy to expand it further to include safe values like ".-+_".

when it comes to program names, i don't think the Android build system has such a limitation.  it is possible to override what gets installed such that you end up with arbitrary (if weird/dumb) names in the fs.  further, if a device manuf has the ability to d/l & run arbitrary code (either their own apps or make a way for users to execute code), then the app name is also arbitrary.  we should keep from generating a corrupt json file because of that.

note: the old format had the same problem -- any field containing a , or whitespace would break things

